<div class="row mt-4">
    <div class="col-lg-3"></div>
    <div class="col-lg-6" style="text-align: center;">
        <h1>Đăng ký môn học - Học kỳ <span id="semester"></span></h1>
        <form method="get" action="/registerCourse" id="form">
            <div class="form-group" style="justify-items: center;">
                <input type="hidden" id="semester-input" name="semester">
                <input type="text" class="form-control" id="info-input" style="width: 50%; display: inline-block"
                    name="info" placeholder="Nhập tên/mã môn học" required>
                <button style="submit" class="btn btn-primary mt-3 mb-3">
                    Tìm kiếm
                </button>
            </div>
            <a id="registered" href="#">Danh sách các môn đã đăng ký</a>
        </form>
    </div>
    <div class="col-lg-3"></div>
</div>

{{#if search}}
<div class="row">
    <div class="col-lg-3"></div>
    <div class="col-lg-6 mt-4">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Tên Môn Học</th>
                    <th scope="col">Mã Môn Học</th>
                    <th scope="col">Giảng Viên</th>
                    <th scope="col">Thứ</th>
                    <th scope="col">Tiết</th>
                    <th scope="col">Số Lượng</th>
                    <th scope="col">Tình Trạng</th>
                </tr>
            </thead>
            <tbody>
                {{#if (checkRoleFix schedules.length 0)}}
                <tr>
                    <td colspan="8" style="text-align: center;">Môn học chưa có lịch học</td>
                </tr>
                {{else}}
                {{#each schedules}}
                <tr>
                    <td>{{sum @index 1}}</td>
                    <td>{{this.courseName}}</td>
                    <td>{{this.courseId}}</td>
                    <td>{{this.teacherName}}</td>
                    <td>{{this.day}}</td>
                    <td>{{this.period}}</td>
                    <td>{{this.studentIds.length}}/40</td>
                    {{#if (checkRegister ../user._id this.studentIds)}}
                    <td><span>Đã đăng ký</span></td>
                    {{else}}
                    <td><a href="#" data-id="{{this._id}}">Đăng ký</a></td>
                    {{/if}}
                </tr>
                {{/each}}
                {{/if}}
            </tbody>
        </table>
    </div>
    <div class="col-lg-3"></div>
</div>
{{/if}}

<form method="post" action="" id="form-a"></form>

<script>
    const registers = document.querySelectorAll('[data-id]');
    const form = document.querySelector('#form-a');
    registers.forEach(register => {
        register.addEventListener('click', (event) => {
            event.preventDefault();
            const id = register.getAttribute('data-id');
            form.action = `registerCourse/${id}?_method=PATCH`;
            form.submit();
        })
    });
    document.addEventListener('DOMContentLoaded', () => {
        const currentDate = new Date();
        const month = currentDate.getMonth();
        const year = currentDate.getFullYear();
        let value = year % 100;
        if (month <= 8 && month >= 7) value = value + "1";
        else if (month < 7 && month >= 2) value = value + "3";
        else value = value + "2";
        const semesterRender = document.querySelector('#semester');
        semesterRender.innerHTML = value;
        const semester = document.querySelector('#semester-input');
        semester.value = value;
        let registered = document.querySelector('#registered');
        registered.href = `/registerCourse/list?semester=${value}`;
    });
</script>